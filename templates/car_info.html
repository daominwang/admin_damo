{% extends 'index.html' %}

{% block content_css %}
    <style>
        .layui-form-pane .layui-form-label {
            width: 160px;
        }

        .layui-form {
            margin-top: 20px;
            margin-left: 100px;
        }

        .layui-form-item .layui-input-inline {
            width: 250px;
        }

        .layui-layedit {
            width: calc(100% - 100px);
        }

        #car_img_preview {
            max-height: 300px;
        }
    </style>
{% endblock %}

{% block content %}
    <div style="display: block;">
        <form class="layui-form layui-form-pane">
            <div class="layui-form-item layui-hide">
                <label class="layui-form-label">id</label>
                <div class="layui-input-inline">
                    <input type="number" min="0" name="id" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.id or '' }}">
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">车型图片</label>
                    <button type="button" class="layui-btn layui-btn-danger" id="img"><i class="layui-icon"></i>上传图片</button>
                    <div class="layui-upload-list">
                        <img class="layui-upload-img" id="car_img_preview" src="{{ car.img or '' }}">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">车型</label>
                    <div class="layui-input-inline">
                        <select name="car_type">
                            <option value="奥迪" {{ 'selected' if '奥迪' in car.car_type else '' }}>A-奥迪</option>
                            <option value="奔驰" {{ 'selected' if '奔驰' in car.car_type else '' }}>B-奔驰</option>
                            <option value="别克" {{ 'selected' if '别克' in car.car_type else '' }}>B-别克</option>
                            <option value="保时捷" {{ 'selected' if '保时捷' in car.car_type else '' }}>B-保时捷</option>
                            <option value="宾利" {{ 'selected' if '宾利' in car.car_type else '' }}>B-宾利</option>
                            <option value="宝马" {{ 'selected' if '宝马' in car.car_type else '' }}>C-宝马</option>
                            <option value="长安" {{ 'selected' if '长安' in car.car_type else '' }}>C-长安</option>
                            <option value="大众" {{ 'selected' if '大众' in car.car_type else '' }}>D-大众</option>
                            <option value="东本" {{ 'selected' if '东本' in car.car_type else '' }}>D-东本</option>
                            <option value="丰田" {{ 'selected' if '丰田' in car.car_type else '' }}>F-丰田</option>
                            <option value="广本" {{ 'selected' if '广本' in car.car_type else '' }}>G-广本</option>
                            <option value="华晨" {{ 'selected' if '华晨' in car.car_type else '' }}>H-华晨</option>
                            <option value="Jeep" {{ 'selected' if 'Jeep' in car.car_type else '' }}>J-Jeep</option>
                            <option value="江淮" {{ 'selected' if '江淮' in car.car_type else '' }}>J-江淮</option>
                            <option value="金龙" {{ 'selected' if '金龙' in car.car_type else '' }}>J-金龙</option>
                            <option value="考斯特" {{ 'selected' if '考斯特' in car.car_type else '' }}>K-考斯特</option>
                            <option value="马自达" {{ 'selected' if '马自达' in car.car_type else '' }}>M-马自达</option>
                            <option value="全顺" {{ 'selected' if '全顺' in car.car_type else '' }}>Q-全顺</option>
                            <option value="现代" {{ 'selected' if '现代' in car.car_type else '' }}>X-现代</option>
                            <option value="雪铁龙" {{ 'selected' if '雪铁龙' in car.car_type else '' }}>X-雪铁龙</option>
                            <option value="依维柯" {{ 'selected' if '依维柯' in car.car_type else '' }}>Y-依维柯</option>
                            <option value="三菱" {{ 'selected' if '三菱' in car.car_type else '' }}>S-三菱</option>
                            <option value="尼桑" {{ 'selected' if '尼桑' in car.car_type else '' }}>S-尼桑</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">标题</label>
                    <div class="layui-input-inline">
                        <input type="text" name="car_title" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.car_title or '' }}">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">类型</label>
                    <div class="layui-input-inline">
                        <select name="classification">
                            <option value="越野车" {{ 'selected' if '越野车' in car.classification else '' }}>越野车</option>
                            <option value="轿车" {{ 'selected' if '轿车' in car.classification else '' }}>轿车</option>
                            <option value="商务车" {{ 'selected' if '商务车' in car.classification else '' }}>商务车</option>
                            <option value="跑车" {{ 'selected' if '跑车' in car.classification else '' }}>跑车</option>
                            <option value="大客车" {{ 'selected' if '大客车' in car.classification else '' }}>大客车</option>
                            <option value="婚庆租车" {{ 'selected' if '婚庆租车' in car.classification else '' }}>婚庆租车</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">城市</label>
                    <div class="layui-input-inline">
                        <select name="city">
                            <option value="成都市">成都市</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">库存</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="car_left" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.car_left or 0 }}">
                    </div>
                </div>
            </div>

            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>原价</legend>
            </fieldset>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">日租价</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="day_rent_original" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.day_rent_original or 0 }}">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">押金(预授权)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="deposit_original" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.deposit_original or 0 }}">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">每日限里程数(公里)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="mileage_limit_per_day_original" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.mileage_limit_per_day_original or 0 }}">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">超公里费(每公里)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="ext_mileage_pay_original" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.ext_mileage_pay_original or 0 }}">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">超时费(每小时)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="ext_time_pay_original" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.ext_time_pay_original or 0 }}">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">包月价</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="month_rent_original" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.month_rent_original or 0 }}">
                    </div>
                </div>
            </div>

            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>活动价</legend>
            </fieldset>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">日租价</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="day_rent_actual" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.day_rent_actual or 0 }}">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">押金(预授权)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="deposit_actual" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.deposit_actual or 0 }}">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">每日限里程数(公里)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="mileage_limit_per_day_actual" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.mileage_limit_per_day_actual or 0 }}">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">超公里费(每公里)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="ext_mileage_pay_actual" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.ext_mileage_pay_actual or 0 }}">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">超时费(每小时)</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="ext_time_pay_actual" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.ext_time_pay_actual or 0 }}">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">包月价</label>
                    <div class="layui-input-inline">
                        <input type="number" min="0" name="month_rent_actual" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ car.month_rent_actual or 0 }}">
                    </div>
                </div>
            </div>

            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>描述</legend>
            </fieldset>

            <div class="layui-form-item">
                <textarea id="car_desc">{{ car.car_desc or '' }}</textarea>
            </div>

            <div class="layui-form-item" style="margin-left: 250px">
                <div class="layui-inline">
                    <button class="layui-btn" lay-submit="" lay-filter="save">保存</button>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn" lay-submit="" lay-filter="cancel">取消并返回</button>
                </div>
            </div>
        </form>
    </div>
{% endblock %}

{% block content_javascript %}
    <script>
        var layedit, layer, form, index, upload;
        layui.use('layedit', function () {
            layedit = layui.layedit;
            index = layedit.build('car_desc', {
                height: 180 //设置编辑器高度
            }); //建立编辑器
        });

        layui.use(['layer', 'form'], function () {
            layer = layui.layer;
            form = layui.form;
            form.on('submit(save)', function (data) {
                layedit.sync(index);
                data.field.car_desc = $('#car_desc').val();
                data.field.img = $('#car_img_preview').attr('src');
                $.post('', data.field, function (res) {
                    if (res.code === 200) {
                        layer.msg('保存成功', {icon: 1, time: 1000, shade: [0.8, '#393D49'], shadeClose: true}, function () {
                            window.location.href = '{{ url_for('view.car_manage') }}';
                        })
                    } else {
                        layer.msg(res.msg, {icon: 5, time: 3000, shade: [0.8, '#393D49'], shadeClose: true}, function () {
                            layer.closeAll();
                        })
                    }
                }, 'json');
                return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            });
            form.on('submit(cancel)', function () {
                window.location.href = '{{ url_for('view.car_manage') }}';
                return false;
            })
        });

        layui.use('upload', function () {
            upload = layui.upload;
            var upload_data;
            upload.render({
                elem: '#img'
                , url: '/upload'
                , before: function (obj) {
                    upload_data = obj;
                }
                , done: function (res) {
                    if (res.code !== 200) {
                        return layer.alert('上传失败，请重试', {icon: 5, time: 3000})
                    } else {
                        upload_data.preview(function () {
                            $('#car_img_preview').attr('src', res.msg);
                        });
                    }
                }
                , error: function () {
                    return layer.alert('上传失败，请重试', {icon: 5, time: 3000})
                }
            })
        });
    </script>
{% endblock %}